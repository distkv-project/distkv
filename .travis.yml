language: generic
os: linux
# Use Ubuntu 16.04
dist: xenial
install: true

cache:
  directories:
    - $HOME/.m2
addons:
  apt:
    sources:
      - deadsnakes # source required so it finds the package definition below
    packages:
      - python3.6
before_install:
  - sudo pip install virtualenv
  - virtualenv -p `which python3.6` .venv
  - source .venv/bin/activate
  - python -V
  - pip -V
  - pip install six
  - pip install -r cmd/refframes/reqs.txt
  - wget -O cmd/refframes/spicekernels/de430.bsp https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de430.bsp

before_script:
  - bash ./scripts/install_dependencies.sh

# Define some parallel jobs.
jobs:
  include:
    # Test for jdk8
    - os: linux
      jdk: openjdk8
      dist: xenial
      script:
        - travis_wait 30 ./mvnw clean install -DskipTests=false

    # Test for jdk11
    - os: linux
      jdk: openjdk11
      dist: xenial
      script:
        - travis_wait 30 ./mvnw clean install -DskipTests=false

    # Test for jdk14
    - os: linux
      jdk: openjdk14
      dist: xenial
      script:
        - travis_wait 30 ./mvnw clean install -DskipTests=false

    # This job is used to test `pip install dkv`.
    - os: osx
      language: python
        python:
          - "3.6"
        virtualenv:
          system_site_packages: true
      script:
        - pushd deploy/python
        - sudo sh test_pip_install.sh
        - popd

after_success:
  - bash <(curl -s https://codecov.io/bash)
  - bash <(curl -s https://oapi.dingtalk.com/robot/send?access_token=4751a9833880fef766481c835b9f156deaaf77594d77b7b2c7a79bef3de924dc)

after_failure:
  - echo "Failed to build!"
